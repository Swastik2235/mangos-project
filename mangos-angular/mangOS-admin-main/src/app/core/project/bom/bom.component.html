<div class="bom-container" >
	<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "large" color = "#fff" type = "pacman" [fullScreen] = "true"><p style="color: white" > Loading... </p></ngx-spinner>
	<div class="bomHeader">
		<div fxLayout="row" fxFlexFill>
			<div fxFlex="25" fxFlexAlign="start">
				<div class="projectFilter">
					<mat-form-field appearance="outline">
						<mat-label>Projects</mat-label>
						<mat-select [formControl]="sproject" (selectionChange)="projectBom($event.value)">
						  <mat-option *ngFor="let project of projectList" [value]="project.slug">
							{{project.title}}
						  </mat-option>
						</mat-select>
					</mat-form-field>
				</div>
			</div>
			<div fxFlex="25" fxFlexAlign="start">
				<div class="bomFilter">
					<mat-form-field appearance="outline">
					  <mat-label>Search</mat-label>
					  <input matInput (keyup)="applyFilter($any($event.target).value)" placeholder="Filter Invites..." #input>
					</mat-form-field>
				</div>
			</div>
			<div fxFlex="15" fxFlexAlign="start">
				<button mat-raised-button color="primary" (click)="importBomFile()">Import BOM</button>
			</div>
			<div fxFlex="15" fxFlexAlign="start">
				<button mat-raised-button color="primary" (click)="addBomFile()">Create BOM</button>
			</div>
			<div fxFlex="15" fxFlexAlign="start">
				<button mat-raised-button color="primary" (click)="addNewJobCard()">Create Job Card</button>
			</div>
			<div fxFlex="5" fxFlexAlign="end">
				<button mat-icon-button class="more-button account" [matMenuTriggerFor]="menu" aria-label="Toggle menu">
				 <mat-icon>more_vert</mat-icon>
				</button>
				<mat-toolbar>
				<mat-menu #menu="matMenu" xPosition="before">
					<!-- <div  style="float: right;display: flex;" class="downloadButton"> -->
						<button mat-menu-item class="create" (click)='downloadFile("excel")'><mat-icon class='mv'>description</mat-icon> excel</button>
						<button mat-menu-item class="create" (click)='downloadFile("pdf")'><img src="../assets/images/pdf.jpeg" class ='downlodaBtnImage-mv' height="20" width="20"> pdf</button>
						<button mat-menu-item class="create" (click)='downloadFile("csv")'><img src="../assets/images/csv.jpeg" class ='downlodaBtnImage-mv' height="20" width="20"> csv</button>
					<!-- </div> -->
				</mat-menu>
			</mat-toolbar>
			</div>
		</div>
	</div>
	<div class="mat-elevation-z8 bomTableEdit">
		<form [formGroup]="VOForm" autocomplete="off">
			<ng-container formArrayName='jobitems'>
				
				<table mat-table class="full-width-table" matSort [dataSource]="dataSource">
					<!-- Checkbox Column -->
					<ng-container matColumnDef="select">
						<th mat-header-cell *matHeaderCellDef>
						  	<mat-checkbox (change)="$event ? masterToggle() : null"
										[checked]="selection.hasValue() && isAllSelected()"
										[indeterminate]="selection.hasValue() && !isAllSelected()">
						  	</mat-checkbox>
						</th>
						<td mat-cell *matCellDef="let element">
							<!-- {{ element.jobcard}} -->
							<mat-checkbox (click)="$event.stopPropagation()"
										(change)="$event ? selection.toggle(element) : null"
										[checked]="selection.isSelected(element) ">
							</mat-checkbox>
						</td>
					</ng-container>

					<!-- mark Column -->
					<ng-container matColumnDef="mark">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Mark</th>
						<td mat-cell *matCellDef="let element; let i = index" class="readonlyColumn" [formGroupName]="i">
							<!-- {{row.mark_detail.title}} -->
							<mat-form-field style="width: 70px;">
							  <input matInput type="text" formControlName="mark" [readonly]="true">
							</mat-form-field>
						</td>
					</ng-container>

					<!-- number Column -->
					<ng-container matColumnDef="number">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Number</th>
						<td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i">
							<!-- {{row.number}} -->
							<mat-form-field style="width: 70px;">
								<!-- id = {{ element.id }},{{editRowIndex}} -->
							  <input matInput type="text" formControlName="number" [readonly]="true" >
							</mat-form-field>
						</td>
					</ng-container>

					<!-- Name Column -->
					<ng-container matColumnDef="section">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Section</th>
						<td mat-cell *matCellDef="let element; let i = index" class="readonlyColumn" [formGroupName]="i">
							<!-- {{row.section_detail.title}} -->
							<mat-form-field style="width: 110px;">
							  <input matInput type="text" formControlName="section" [readonly]="true">
							</mat-form-field>
						</td>
					</ng-container>


					<!-- length Column -->
					<ng-container matColumnDef="length">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Length</th>
						<td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i">
							<!-- {{row.length}} -->
							<mat-form-field style="width: 70px;">
							  <input matInput type="text" formControlName="length" [readonly]="!isEditableNew">
							</mat-form-field>
						</td>
					</ng-container>

					<!-- width Column -->
					<ng-container matColumnDef="width">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Width</th>
						<td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i">
							<!-- {{row.width}} -->
							<mat-form-field style="width: 70px;">
							  <input matInput type="text" formControlName="width" [readonly]="!isEditableNew">
							</mat-form-field>
						</td>
					</ng-container>

					<!-- unit_weight Column -->
					<ng-container matColumnDef="unit_weight">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Unit Wt</th>
						<td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i">
							<!-- {{row.unit_weight}} -->
							<mat-form-field style="width: 70px;">
							  <input matInput type="text" formControlName="unit_weight" [readonly]="!isEditableNew">
							</mat-form-field>
						</td>
					</ng-container>

					<!-- piece_weight Column -->
					<ng-container matColumnDef="piece_weight">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Piece Wt</th>
						<td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i">
							<!-- {{row.piece_weight}} -->
							<mat-form-field style="width: 70px;">
							  <input matInput type="text" formControlName="piece_weight" [readonly]="!isEditableNew">
							</mat-form-field>
						</td>
					</ng-container>

					<!-- quantity Column -->
					<ng-container matColumnDef="quantity">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>QTY</th>
						<td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i">
							<!-- {{row.quantity}} -->
							<mat-form-field style="width: 70px;">
							  <input matInput type="number" formControlName="quantity" [readonly]="!isEditableNew">
							</mat-form-field>
						</td>
					</ng-container>

					<!-- tower Column -->
					<ng-container matColumnDef="tower_quantity">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Tower QTY</th>
						<td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i">
							<!-- {{row.tower}} -->
							<mat-form-field style="width: 70px;">
								<input matInput type="number" formControlName="tower_quantity" [readonly]="!isEditableNew">
							</mat-form-field>
						</td>
					</ng-container>

					<!-- weight Column -->
					<ng-container matColumnDef="weight">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Weight</th>
						<td mat-cell *matCellDef="let element; let i = index" [formGroupName]="i">
							<!-- {{row.weight}} -->
							<mat-form-field style="width: 70px;">
								<input matInput type="text" formControlName="weight" [readonly]="!isEditableNew">
							</mat-form-field>
						</td>
					</ng-container>

					<!-- operation Column -->
					<ng-container matColumnDef="operation">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Operation</th>
						<td mat-cell *matCellDef="let element; let i = index" class="readonlyColumn" [formGroupName]="i">
							<!-- {{element.operation}} -->
							<mat-form-field style="width: 70px;">
								<input matInput type="text" formControlName="operation" [readonly]="!isEditableNew">
							</mat-form-field>
						</td>
					</ng-container>

					<!-- Quantity Column -->
					<ng-container matColumnDef="total_quantity">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Total QTY</th>
						<td mat-cell *matCellDef="let element; let i = index" class="readonlyColumn">
							{{element.quantity*element.tower_quantity}}
							<!-- <mat-form-field style="width: 70px;">
							  <input matInput type="text" formControlName="total_quantity" [readonly]="true">
							</mat-form-field> -->
						</td>
					</ng-container>

					<!-- remark Column -->
					<ng-container matColumnDef="total_weight">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Total Wt</th>
						<td mat-cell *matCellDef="let element; let i = index" class="readonlyColumn">
							<span>{{element.unit_weight*element.piece_weight | number : '2.2-2' }}</span>
							<!-- <mat-form-field style="width: 70px;">
							  <input matInput type="text" formControlName="total_weight" [readonly]="true">
							</mat-form-field> -->
						</td>
					</ng-container>

					<!-- remark Column -->
					<ng-container matColumnDef="action">
						<th mat-header-cell *matHeaderCellDef mat-sort-header>Action</th>
						<td mat-cell *matCellDef="let element; let i = index">
							<button mat-icon-button size="small" color="primary" (click)="EditSVO(jobitems,element,i)" *ngIf="!isEditableNew">
								<mat-icon>mode</mat-icon>
							</button>
							<button mat-icon-button class="material-icons app-toolbar-menu save-button"
								matTooltip="Save Changes" (click)="SaveVO(jobitems,element,i)"
								*ngIf="isEditableNew" color="primary">
								<mat-icon>check_circle</mat-icon>
							</button>
							<button mat-icon-button color="warn" (click)="deleteDialog(i)" *ngIf="!isEditableNew">
								<mat-icon>delete</mat-icon>
							</button>
							<button mat-icon-button class="material-icons app-toolbar-menu cancel-button"
								matTooltip="Cancel Changes" color="warn"
								(click)="CancelSVO(element,i)"
								*ngIf="isEditableNew">
								<mat-icon>cancel</mat-icon>
							</button>
						</td>
					</ng-container>

					<tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
					<tr mat-row *matRowDef="let row; columns: displayedColumns;let i = index" [ngClass]="(isEditableNew == true && row.id == editRowIndex ? 'tabelEditRow':'noEditRow')" ></tr>

					<!-- Row shown when there is no matching data. -->
					<tr class="mat-row" *matNoDataRow > 
					  <td class="mat-cell" colspan="14">Please Select a Project First.</td>
					</tr>
				</table>
			</ng-container>
		</form>

		<mat-paginator #paginator
				[length]="dataSource?.data?.length"
				[pageIndex]="0"
				[pageSize]="50"
				[pageSizeOptions]="[50, 100, 200,500,1000]">
		</mat-paginator>
	</div>
</div>
