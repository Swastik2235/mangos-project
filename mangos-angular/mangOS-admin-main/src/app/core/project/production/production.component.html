<div class="production-container" >
	<ngx-spinner bdColor = "rgba(0, 0, 0, 0.8)" size = "large" color = "#fff" type = "pacman" [fullScreen] = "true"><p style="color: white" > Loading... </p></ngx-spinner>
	<div class="bomHeader">
		<div fxLayout="row" fxFlexFill>
			<div fxFlex="20" fxFlexAlign="start">
				<div class="projectFilter">
					<mat-form-field appearance="outline">
						<mat-label>Projects</mat-label>
						<mat-select [formControl]="sproject" (selectionChange)="projectBom($event.value)">
						  <mat-option *ngFor="let project of projectList" [value]="project.slug">
							{{project.title}}
						  </mat-option>
						</mat-select>
					</mat-form-field>
				</div>
			</div>
			<div fxFlex="25" fxFlexAlign="start">
				<div class="bomFilter">
					<mat-form-field appearance="outline">
					  <mat-label>Search</mat-label>
					  <input matInput (keyup)="applyFilter($any($event.target).value)" placeholder="Filter Invites..." #input>
					</mat-form-field>
				</div>
			</div>
			<div fxFlex="12" fxFlexAlign="start">
				<button mat-raised-button color="primary" (click)="updateItem('Cutting')"><mat-icon>eject</mat-icon> Cutting</button>
			</div>
			<div fxFlex="15" fxFlexAlign="start">
				<button mat-raised-button color="primary" (click)="updateItem('Fabrication')"><mat-icon>eject</mat-icon> Fabrication</button>
			</div>
			<div fxFlex="15" fxFlexAlign="start">
				<button mat-raised-button color="primary" (click)="updateItem('Galvanizing')"><mat-icon>eject</mat-icon> Galvanizing</button>
			</div>
			<div fxFlex="15" fxFlexAlign="start">
				<button mat-raised-button color="primary" (click)="updatePackaging()"><mat-icon>eject</mat-icon> Packaging</button>
			</div>
		</div>
	</div>
	<div class="mat-elevation-z8 table-container">
		<table mat-table class="full-width-table" matSort aria-label="Elements" [dataSource]="dataSource">
			

			<!-- mark Column -->
			<ng-container matColumnDef="pkg" sticky>
				<th mat-header-cell *matHeaderCellDef>
					Pkg
				</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems" style="font-size: 15px;">
								<mat-checkbox  (change)="getPackaging($event,item)" [checked]="item.dispatch"
								[class.mat-checkbox-disabled]=" item.fabrication && item.galvanizing && item.cutting || item.dispatch? false : true"
       							 [disabled]= " item.fabrication && item.galvanizing && item.cutting && !item.dispatch ? false : true ">
								</mat-checkbox>
							</tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="mark" sticky>
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Mark</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>{{ item.bom_detail.mark_detail.title }}</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<!-- number Column -->
			<ng-container matColumnDef="number" sticky>
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Number</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>{{ item.bom_detail.number }}</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<!-- Name Column -->
			<ng-container matColumnDef="section" sticky>
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Section </th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table >
							<tr mat-cell *ngFor="let item of row.jobitems"><td >{{ item.bom_detail.section_detail.title }}</td></tr>
						</table>
					</div>
				</td>
			</ng-container>



			<ng-container matColumnDef="c-quantity">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Qty</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>{{ item.quantity }}</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="c-weight">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Weight</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>{{ item.total_weight }}</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="c-balanceQty">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Bal Qty</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>0.0</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="c-balanceWt">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Bal WT</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>0.0</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="c-select">
				<th mat-header-cell *matHeaderCellDef>
					Select
					<!-- <mat-checkbox (change)="$event ? cuttingToggle() : null"
							[checked]="selection.hasValue() && cuttingSelected()"
							[indeterminate]="selection.hasValue() && !isAllSelected()">
					</mat-checkbox> -->
				</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems" style="font-size: 15px;">
								<mat-checkbox  [color]="colour" (change)="getCutting($event,item)" [checked]="item.cutting" [disabled]="item.cutting">
								</mat-checkbox>
							</tr>
						</table>
					</div>
				</td>
			</ng-container>
			<ng-container matColumnDef="f-quantity">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Qty</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>{{ item.quantity }}</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="f-weight">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Weight</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>{{ item.total_weight }}</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="f-balanceQty">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Bal Qty</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>0.0</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="f-balanceWt">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Bal WT</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0">
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems"><td>0.0</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="f-select">
				<th mat-header-cell *matHeaderCellDef>
					Select
					<!-- <mat-checkbox (change)="$event ? masterToggle() : null"
							[checked]="selection.hasValue() && isAllSelected()"
							[indeterminate]="selection.hasValue() && !isAllSelected()">
					</mat-checkbox> -->
				</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0">
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems">
								<mat-checkbox [color]="colour"  (change)="getfab($event,item)" [checked]="item.fabrication" [disabled]="item.fabrication">
								</mat-checkbox>
							</tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="g-quantity">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Qty</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr  *ngFor="let item of row.jobitems"><td>{{ item.quantity }}</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="g-weight">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Weight</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr  *ngFor="let item of row.jobitems"><td>{{ item.total_weight }}</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="g-balanceQty">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Bal Qty</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr  *ngFor="let item of row.jobitems"><td>0.0</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="g-balanceWt">
				<th mat-header-cell *matHeaderCellDef mat-sort-header>Bal WT</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0" >
						<table>
							<tr *ngFor="let item of row.jobitems"><td>0.0</td></tr>
						</table>
					</div>
				</td>
			</ng-container>

			<ng-container matColumnDef="g-select">
				<th mat-header-cell *matHeaderCellDef>
					Select
					<!-- <mat-checkbox (change)="$event ? masterToggle() : null"
							[checked]="selection.hasValue() && isAllSelected()"
							[indeterminate]="selection.hasValue() && !isAllSelected()">
					</mat-checkbox> -->
				</th>
				<td mat-cell *matCellDef="let row">
					<div *ngIf="row.jobitems.length>0">
						<table>
							<tr mat-cell *ngFor="let item of row.jobitems">
								<mat-checkbox [color]="colour"
								(change)="getGal($event,item)" [checked]="item.galvanizing" [disabled]="item.galvanizing">
								</mat-checkbox>
							</tr>
						</table>
					</div>
				</td>
			</ng-container>

			
			<!-- Header row second group ------->
			<ng-container matColumnDef="Production Entry" sticky>
				<th mat-header-cell *matHeaderCellDef [attr.colspan]="4" > Production Entry </th>
			</ng-container>
			  
			  
			<ng-container matColumnDef="Cutting">
				<th mat-header-cell *matHeaderCellDef [attr.colspan]="5"> Cutting </th>
			</ng-container>

			<ng-container matColumnDef="Fabrication">
				<th mat-header-cell *matHeaderCellDef [attr.colspan]="5"> Fabrication </th>
			</ng-container>

			<ng-container matColumnDef="Galvanizing">
				<th mat-header-cell *matHeaderCellDef [attr.colspan]="5"> Galvanizing </th>
			</ng-container>

			<tr mat-header-row *matHeaderRowDef="displayedHeader; sticky: true"></tr>
			<tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
			<tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
		</table>

		<mat-paginator #paginator
				[length]="dataSource?.data?.length"
				[pageIndex]="0"
				[pageSize]="50"
				[pageSizeOptions]="[50, 100, 200,500,1000]">
		</mat-paginator>
	</div>
</div>
